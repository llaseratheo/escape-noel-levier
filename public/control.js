document.addEventListener('DOMContentLoaded', function(){ const ctrl=document.createElement('div'); ctrl.style.position='fixed'; ctrl.style.left='12px'; ctrl.style.bottom='12px'; ctrl.style.zIndex=10002; ctrl.style.display='flex'; ctrl.style.gap='8px'; const btnMusic=document.createElement('button'); btnMusic.textContent='🎵'; btnMusic.className='eg-btn'; const btnNarr=document.createElement('button'); btnNarr.textContent='🗣️'; btnNarr.className='eg-btn'; ctrl.appendChild(btnMusic); ctrl.appendChild(btnNarr); document.body.appendChild(ctrl); const music=new Audio('/assets/musique_intro.wav'); music.loop=false; music.volume=0.28; const narration=new Audio('/assets/voice_narration.wav'); narration.volume=0.95; const jingle=new Audio('/assets/jingle.wav'); jingle.volume=0.9; const enigmes=new Audio('/assets/music_enigmes.wav'); enigmes.loop=true; enigmes.volume=0.22; btnMusic.onclick=()=>{ if(music.paused){ music.play(); btnMusic.classList.remove('off'); } else { music.pause(); btnMusic.classList.add('off'); } }; btnNarr.onclick=()=>{ if(narration.paused){ narration.play(); btnNarr.classList.remove('off'); } else { narration.pause(); btnNarr.classList.add('off'); } }; narration.play().catch(()=>{}); music.play().catch(()=>{}); narration.addEventListener('ended', ()=>{ try{ jingle.play().catch(()=>{}); }catch(e){} const startBtn=document.getElementById('startButton'); if(startBtn) startBtn.style.display='inline-block'; }); const startButton=document.getElementById('startButton'); if(startButton){ startButton.addEventListener('click', ()=>{ const fadeOut=(audio,time)=>{ const steps=20; let i=0; const volStart=audio.volume; const intv=setInterval(()=>{ i++; audio.volume = volStart * (1 - i/steps); if(i>=steps){ clearInterval(intv); audio.pause(); audio.volume = volStart; } }, time/steps); }; fadeOut(music,800); fadeOut(narration,800); jingle.play().catch(()=>{}); setTimeout(()=>{ enigmes.play().catch(()=>{}); if(window.startSnow) window.startSnow(); document.getElementById('introWrap').style.opacity=0; setTimeout(()=>{ document.getElementById('introWrap').style.display='none'; },700); },900); }); } setTimeout(()=>{ const sb=document.getElementById('startButton'); if(sb && sb.style.display==='none'){ sb.style.display='inline-block'; } },11000); window.__eg={music,narration,enigmes}; });